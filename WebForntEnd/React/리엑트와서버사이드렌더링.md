
# 왜 React와 서버 사이드 렌더링인가?

ajax가 없던 시절 -> ajax의 등장 -> Javascript 뷰 렌더링 -> Template engine -> Framework -> AngularJS

## AngularJS

### 개발속도가 빠름
- 특별한 추가 코드 없이 변수 할당만으로 양방향 데이터 바인딩 지원. get/set 함수 필요없음
- 별도의 템플릿 코드 분리 없이 뷰-데이터 연동. 기본 HTML이 곧 템플릿파일
- DI(Dependency Injection) 패턴사용. new같은 없고 그냥 인자로 넘기기만 하면됨
- 모듈화가 잘되어 있어 재사용이 용이함
- 플러그인이 엄청나게 많음

### 유지보수가 쉬움
- Javascript 코드량이 적음
- MVC 패턴이 잘 정리되어 있어 개발자간 코드가 비슷함
- Controller, Directive, Filter, Service 모듈 구분이 명확

### 테스트 코드 작성 용이
- 모듈별 테스트 작성이 쉬움. 튜토리얼도 테스트코드부터 시작함
- 데이터 로딩 시점이 비동기인 경우 E2(Eend-to-end) 테스트가 까다로운 경우가 있는데 Protractor를 사용하면 간단함

### 프로젝트 분리
- 백엔드를 API서버로 사용하여 프론트엔드와 완전히 분리할 수 있음
- 템플릿을 스크립트 태그나 Javascript에서 관리하지 않고 HTML을 그대로 사용하여 퍼블리셔 협업도 좋음

### 구글이 관리함
- 오오, 구글에서 지메일, 캘린더 이런걸로 만드는건가??
- 망하진 않겠다!

## AngularJS의 단점

- 속도가 느림. 특히 모바일
- IE8지원안함
- 러닝커브가 높음. 특히 Directive는 공부할수록 헬
- 비표준 태그 사용의 찝찝함. (대부분의 브라우져가 잘 처리하긴 하지만서도..)
- 페이지 깜빡임 이슈(FOUCFlash of unstyled content)
- 묘한 애니메이션 적용. 컨텐츠가 그려지는 시점을 정확하게 제어하기 어려워 애니메이션 적용이 쉽지 않음
- SEO 이슈. 크롤링 봇은 컨텐츠 로딩전 빈페이지만 바라봄. title, meta tag도 처음 페이지것만 바라봄
- 뒤로가기 하면 페이지 새로 로딩함. history API를 이용한 페이지 이동이 실제로는 페이지를 동적으로 로딩하는 구조. 스크롤도 최상단으로 이동
- 외부 서비스 콜백처리
  - 외부(페이스북, 구글, …) 로그인 후 돌아오는 페이지는 어떻게 처리하나?
  - 이메일 회원가입 확인 페이지는 어떻게 하나?
  - 결제 페이지 이동은 어떻게 하나?
  - 결국 백엔드쪽에 뷰 페이지를 만들어야 하나?
- Angular 2와의 호환성
  - Angular 2는 완전히 다르다?!
  - 기존 1버전은 곧 지원 중단?!
  - 호환이 안된다? 업데이트가 안된다?!
- TypeScript만 지원한다? 그게 뭔데 ㅠ
- 구글도 자기 서비스에 안씀
  - 안쓰는 줄 알았는데 사용하고 있었네요 (강규현님 감사합니다)
  - https://www.madewithangular.com/#/categories/google

> 엄청난 장점만큼 단점을 같이 보았는데 사실 대부분의 단점은 AngularJS의 단점이라기 보다는 웹앱의 단점입니다.   
> AngularJS는 앱용 웹에 적합한 프레임워크입니다.   
> 가만보니 공식사이트 메인에 HTML enhanced for web apps! 라고 적혀있습니다.   
> AngularJS는 좋지만, 웹앱용에 한정이고 성능이 크게 중요치 않은 어드민이나 내부서비스에 적합하다고 결론을 내립니다.  

## ReactJS
React는 MVC프레임워크는 아니고 User Interface(View)를 만드는 라이브러리입니다.   
AngularJS처럼 MVC를 표방하는 것이 아니라 V(iew)에 집중하였고 훨씬 가벼웠습니다.   

### React의 장점
- 쉽다. API가 몇개 없다. 일단 시작하긴 쉽다.
- 빠르다. 느린 DOM대신 Virtual DOM이라는 걸 이용.
- 단순하다. 2-way 바인딩 대신 1-way를 지원하고 Component 구성하기 쉬움.
- 서버 사이드 렌더링 지원이 좋음
- ES6지원 좋음
- 일부페이지에 큰 수정없이 바로 적용할 수 있음

## 서버 사이드 렌더링의 장점
- 유저가 처음으로 컨텐츠를 보는 속도가 빨라짐
- 서버따로 클라이언트따로 작성하던 코드가 하나로 합쳐짐
- SEO 적용도 OK
- 웹앱의 단점 대부분 없어짐!

## React 서버 사이드 렌더링
React는 서버 사이드 렌더링을 염두에 두고 설계되었습니다.  

ReactDOMServer.renderToString 함수는 서버 사이드에서 사용하는 렌더링 함수입니다.  
이 함수는 HTML을 생성하는데 클라이언트에서 동적으로 생성하는 것과 동일한 HTML을 생성합니다.  
다른점은 data-react-checksum과 같은 attribute가 추가되었다는 점입니다.  

서버 사이드에서 생성된 HTML에는 이벤트 속성이 없기 때문에 반드시 ReactDOM.render()과 같은 클라이언트 사이드 렌더링을 다시 한번 수행해야 합니다.  

두번째 렌더링을 할때 이미 서버 사이드 렌더링이 되어 있다면 attribute값을 보고 다시 렌더링 하지 않고 생성된 DOM에 오직 이벤트 속성만 추가합니다. checksum을 보고 판단하기 때문에 속도가 굉장히 빠릅니다.  

## SPA와 Server Side Rendering
Single Page Application 에서도 검색 엔진 또는 페이스북 등과 같은 크롤러들에게 대응하거나 사용자가 직접 특정 URL을 입력하여 접근하는 방법을 지원하기 위해 전통적인 Server Side Rendering 방식을 지원하고 있습니다.  
일반적인  Single Page Application 에 비해 약간은 추가 처리가 필요한 것이 있어 처음에는 이런 저런 다른 방식을 고민해보았지만 결국은 Server Side Rendering 이 위의 문제점을 해결하기에는 가장 최적이고 정상적인 방법이라 생각하여 Server Side Rendering을 선택하게 되었습니다.  

## SSR 단점
SSR이 앞서 말한 장점을 제공하는 만큼 사용하는데에 있어서 어려움과 번거로움이 생기는 것이 사실이다.  
먼저 서버 코드에 있어서도 JSX를 사용할 수 있도록 빌드나 변환하는 과정이 필요해진다.  
또한 JS 기반인 서버 플랫폼, Node.js로 서버를 할 때, 같은 JS라고 할지라도 클라이언트와 서버가 모든 것을 같이 공유할 수는 없다.(DOM, Document의 URL 등) 이런 부분에 대한 예외 처리는 물론이며 특히 여러가지 라이브러리를 같이 사용하게 되는 경우 더더욱 복잡도는 증가한다.  또한 클라이언트의 부하를 줄였지 서버의 부하는 당연히 일반적인 렌더링보다 더 생긴다.  
그래서 웹 서버와 API 서버를 따로 두는 등의 부하를 줄일 작업이 필요할 것으로 생각된다.  
결론은 SSR이 만능열쇠는 아니란 소리.  

---
참조 : [왜 React와 서버 사이드 렌더링인가?](https://subicura.com/2016/06/20/server-side-rendering-with-react.html)