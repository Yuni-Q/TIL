# 10. 사용자 에러 던지기

- 에러를 어디에 발생시켜야 좋을지 감을 잡으려면 경험이 있어야 하지만 일단 감을 잡으면 디버깅하는 시간이 줄어들고 자신이 짠 코드를 보며 느끼는 만족도 높아집니다.

## 에러의 본질

- 프로그래밍 에러는 예상치 못하게 발생합니다.
- 프로그래밍 언어는 코드가 정해진 기본 규칙에서 벗어나면 개발자에게 코드를 수정하라는 의미로 에러를 발생시킵니다. 만약 엘가 발생하지 않고 개발자에게 알려주지도 않으면 디버깅은 거의 불가능해지며 에러 수저은 고사하고 문제 발생을 알아차리기까지 한참이 걸릴 수 있습니다. 이러한 의미에서 본다면 에러는 개발자의 적이 아니라 오히려 도움이 되는 친구 입니다. 그러나 에러가 예상치 못한 때에 예상치 못한 곳에서 발생하면 문제가 됩니다. 게다가 무엇이 잘못되었는지 파악하기에는 기본 에러 메시지 내용이 너무 간단합니다.
- 이를 해결하기 위해 사용자 에러가 있습니다.
- 사용자 에러를 발생 시킬 때는 자바스크립트에서 언제 에러가 발생하는지를 생각해보면 도움이 됩니다.

## 에러 던지기

- 자바스크립트는 특성상 디버깅이 힘들어 에러를 던지는 것은(throwing) 다른 언어에서보다 더 가치 있는 기능입니다. throw 연산자에 에러로 던질 객체를 넣으면 에러를 발생시킬 수 있습니다.
- 어느 타입의 객체든 에러로 던질 수 있지만, 보통 Error 객체를 많이 사용합니다.
- 기본 내장된 Error 타입은 모든 자바스크립트 구현체에서 사용할 수 있고 Error의 생성자는 에러 메시지를 인자로 받습니다. 하지만 이 방법으로 에러를 발생시키면 try...catch 문으로 에러를 잡을 수 없을 뿐만 아니라 브라우저는 다른 일반적인 에러를 처리하듯이 메시지 값을 보여주기만 합니다. 우리가 던지는 에러는 브라우저에서 던지는 에러와 똑같이 처리됩니다.
  - 자바스크립트 구현체는 자바스크립트 명세를 구현한 엔진을 말하며 SpiderMonkey, Rhino, V8, Webkit, Carakan, Chakara 등이 있습니다. 대표적으로 웹 브라우저에서 이런 엔진을 이용합니다.
- 원한다면 어떤 타입의 데이터든 에러로 던질 수 있으며 특정 데이터 타입을 던지면 안 된다는 규칙은 없습니다.
- 반드시 기억할 점은 try...catch 문으로 에러를 처리 하지 않는 한, 어떤 값을 에러로 던져도 에러가 발생한다는 것입니다.
  - 브라우저마다 에러 표시 방법이 다르지만 모든 브라우저에서 확실하게 사용자 에러 메서지를 보여는 방법은 Error 객체를 사용하는 것입니다.

## 에러를 던지면 좋은점

- 사용자 에러를 던지면 브라우저에서 정확한 메시지를 볼 수 있습니다.
- 에러 메시지에 에러가 발생한 함수명과 에러 발생 이유를 넣을 것을 권장합니다.

## 에러는 언제 던져야 할까

- 에러가 발생하는 곳에서만 에러를 던집니다.
- 모든 자바스크립트 라이브러리는 외부에서 접근 가능한 공개 인터페이스를 작성할 때, 예측할 수 있는 모든 에러 발생 상황에서 에러를 던지도록 코드를 작성해야 합니다.
- 디버깅하기 어려운 에러를 수정하면 거기에 사용자 정의 에러를 추가하십시오. 문제가 다시 발생하면 해결하는 데 큰 도움이 됩니다.
- 코드를 작성할 때, 발생하면 안 된다고 생각하는 일이 발생하면 에러를 던집니다.
- 모른느 사람이 사용할 코드를 작성할 때는 함수를 잘못 사용할 수 있는 경우를 생각해보고 그 경우에 에러를 던지도록 코드를 작성합니다.
- 에러를 던지는 목표는 에러를 막는 것이 아니라 에러가 발생하면 더욱 편하게 디버깅 하는데 있습니다.

## try...catch 문

- 자바스크립트의 try...catch 문을 이용하면 브라우저가 에러를 처리학 ㅣ전에 에러를 먼저 가져올 수 있습니다.
- 에러가 발생할만한 코드를 try 블록에 두고 에러가 발생하면 처리할 코드를 catch 블록에 둡니다.
- try 블록에서 에러가 발생하면 실행이 즉시 중단되고 catch 블록으로 바로 넘어가는데 이때 catch 블록에는 에러 객체가 넘어 옵니다. 따라서 에러를 어떻게 처리해야 할지는 에러 객체를 살펴보면 가장 좋은 방법을 알아낼 수 있습니다. 그릭 finally 절을 추가할 수도 있습니다. finally 절은 에러 발생 여부와 상관없이 반드시 실행되어야 할 코드를 입력합니다.
- finally 절은 다루기에 살짝 까다로울 때가 있습니다. 예를 들어, try 절에 return 문이 있으면 finally 절이 실행된 후에야 return 문이 실행됩니다. 이런 점 때문에 finally 절은 자주 쓰이지 않지만, 필요할 때는 에러 처리에 굉장히 강력한 도구 입니다.

### throw를 쓸 것인가 try...catch를 쓸 것인가

- 에러는 애플리케이션 스택의 가장 깊은 곳인 자바스크립트 라이브러리에서 발생시켜야 합니다.
- 애플리케이션 로직을 다루는 코드에서는 라이브러리에서 던진 에러를 잡아서 잘 처리할 수 있어야 하므로 에러 처리 기능을 잘 갖춰야 합니다.
- catch 절이 비어있는 try...catch는 ㅗ드상에 절대 있으면 안 되고 어떠한 방식으로든 에러 처리를 해야 합니다.

## 에러 타입

- ECMA-262에는 총 7가지 타입의 에러 객체를 정했습니다.
- 여러 타입의 에러가 있다는 것만 알아도 에러를 처리할 때 수월합니다.
- 모든 에러 타입은 Error를 상속받기 때문에 instanceof Error로 검사해서는 필요한 정보를 얻을 수 없습니다.
- 에러 타입을 더욱 상세히 검사하면 더 정밀한 에러 처리를 할수 있습니다.
- 다른 객체로 에러를 던지지 않고 Error 객체로 에러를 던지면 여러 가지 장점이 많습니다.

  - 에러 메시지가 브라우저의 다른 에러 처리 메커니즘과 갗은 방식으로 노출됩니다.
  - 에러가 발생하면 브라우저가 에러 객체에 추가적인 정보를 더 제공합니다.
  - 사용자 정의 에러를 이용하면 시스템 내에서 에러 처리를 적절하게 할 수 있어 매우 유용합니다. 또한 발생한 에러를 올바른 방향으로 처리할 수 있도록 더 많은 에러 정보를 제공하여 상황에 맞는 유연한 처리가 가능합니다.

### Error

- 모든 에러의 기본 타입입니다.
- 엔진에서 이 타입의 에러는 발생하지 않습니다.

### EvalError

- eval()에서 실행한 코드에 실행 중 에러가 있으면 이 타입으로 에러가 발생합니다.욧

### RangeError

- 숫자가 범위를 벗어나면 이 타입의 에러가 발생합니다. 예를 들어 -20개의 요소를 가진 배열을 생성하려고 new Array(-20)이라 하면 RangeError가 발생합니다. 저상적으로 실행된다면 거의 발생하지 않는 에러 입니다.

### SyntaxError

- eval()에 전달한 코드가 문법상 문제가 있으면 발생합니다.

### TypeError

- 변수가 알 수 없는 타입일 때 발생합니다.
- 예를 들어 new 10 또는 "prop" in true 같은 코드를 실행할 때 발생합니다.

### URIErrro

- 잘못된 형식의 URI 문자열이 encodeURI, encodeURIComponent, decodeURI, decodeURIComponent에 전달되면 발생합니다.
