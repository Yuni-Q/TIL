# 변수 선언 방법에 대하여

## 전편에 이어서

- 전의 글로벌편에서 마지막에 '변수가 var로 선언되는 위치는 상관없고, 초기화되는 위치만 상관이 있다'라고 한 다음에, JSLint에서 제안하고 있는 코딩방법을 이어서 이야기하려고 한다. 일단 JSLint가 무엇인지 모른다면 한번쯤은 찾아서 해보는 것도 좋을 것이다. 나중에 이 JSLint라는 툴에 대해서 별도로 자세하게 다루는 기회도 올 것인데, 간단하게 어떠한 기능을 하는지 살펴보고 가자.

## JSLint?

- JSLint는 Douglas Crockford가 만든 '자바스크립트 소스 코드 검정 툴'이다. 올바른 코딩 습관을 가지고 코딩을 하고 있는지 검정하는 툴로 이 툴을 만든 장본인인 Douglas Crockford는 이 툴을 소개할때마다 이러한 말을 한다. "It will hurt your feelings"
- 모든 사람들이 언제나 올바른 코딩 습관을 가질 수 없기도 하고, 이러한 검정툴에서 제안하는 코딩 습관을 모르고 코딩을 한 다음에 이 툴로 validation을 실시하면 그야말로 100개 이상의 지적을 당하게 되기 때문이다. 물론, 이 툴은 오류를 찾아내는 것이 아니라 '오류가 발생할 위험성있는 코딩 습관'을 찾아내는 것이기 때문에 만능은 아니고 자바스크립트 코딩을 하게 되면 어떠한 규칙을 찾아내는지 한번쯤 돌려보면 도움은 될 것이다. 하지만, 이 JSLint 자체는 매우 엄격하고 예외상황을 허용하지 않기 때문에 사람들은 JSLint보다 조금 더 유들한 JSHint를 사용하기도 한다.
- 무튼 이 JSLint에서 제안하고 있는 변수 선언 습관이 있는데, 바로 '모든 변수는 함수의 맨 위에 선언해라'이다.
- 히 이러한 변수 선언 방식은 호불호가 극명하게 갈리기 때문에 '반드시' 지킬 필요는 없다. 하지만 이렇게 권장하고 있는 이유가 몇가지가 있는데, 그 이유는 크게 아래와 같이 꼽을 수 있다.
  - 초기화 실수 최소화
    - '초기화 실수를 최소화'하기 위하여 사용하는 것은, 상단에 모든 변수를 나열하고 필요한 변수들에 대하여 초기화 체크를 할 수 있다는 점이다. 이는 일단 변수를 정의했다면 null이나 0 등과 같은 기본값으로 설정을 해주고, 해당하는 변수가 생성되었는지 아닌지를 먼저 체크하는 것이 검증(validation) 로직을 수행하는데 있어서 조금 더 확실한 정보를 얻을 수 있기 때문이기도 하다. 따라서, 자바스크립트 개발자들 중에서는 'undefined'를 좋아하지 않는다는 사람들이 많기도 하다.
    ```javascript
    console.log("선언을 안한 경우 검사: " + (typeof notExists === "undefined"));
    var notInitialized;
    console.log("초기화를 안한 경우 검사: " + (typeof notInitialized === "undefined"));
    ```
    - 여기서 위의 2가지의 상황에서 검증을 하는 이유는 엄연히 다르지만, 비교를 하는 방법은 두 가지가 똑같이 적용이 가능하다. 따라서, 처음에 개발을 했던 사람은 현재 검증이 '선언을 했는지 여부'를 체크하는 건지, 아니면 '초기화를 안했는지 여부'를 체크하는 건지 알지만, 이후에 유지보수를 할 때 다른 개발자가 이 소스를 본다면 어떠한 검증 과정인지에 대한 소스 분석이 추가로 들어가야 한다. 이 때문에, 많은 자바스크립트 개발자들이 변수를 선언하고 검증을 해야하는 변수들은 기본값 null 등으로 초기화 시켜주고 notInitialized === null 등과 같이 체크하는 것을 선호하게 된 것이다. 이러한 초기화에 대한 관리를 위처럼 상단의 var 에 모아둔다면 이에 대한 휴먼에러는 극명하게 줄어들 것이기 때문에 하나의 var로 뭉치는 것을 선호하는 이유가 된 것이다.
  - 해당 scope에서 사용하는 변수에 대한 관리 용이
    - '해당 scope에 대한 변수들의 관리가 용이'해진다는 이유가 있다. 위의 초기화를 관리하는 것 또한 이 범주와 비슷하기도 하고, 이전 글에서 살펴봤듯이, 자바스크립트는 '선언을 안했다고 해서 에러를 내지 않기 때문에' 어떠한 변수를 선언했는지 관리하는 것이 매우 중요하다. 위의 AJAX를 사용하는 예제를 살펴보면, 외부에서 사용하는 i와 el이 있고, xhr 내부에서 사용하는 i와 el이 있다. 이러한 일반적으로 같은 이름을 가질 수 있는 변수를 사용할 때, 어느 scope에 딸려 있는 i, el 변수인지, 파악할 때 이렇게 변수들을 정리해두면 유용하게 체크할 수 있을 것이다. 게다가 추가적으로 특정 'scope'가 생성될 때 그 위치에 현재 scope에서 사용되고 있는 변수명들을 쭉 나열하고 초기화 값들만 봐도 현재 scope에서 어떠한 작업을 할 것인지 대충 파악 하는 것 또한 가능하다.
  - minification의 최적화
    - 사실 위의 특징들만 따지고 보면 그다지 사용할 이유가 없어보이는 것은 사실이다. 오히려 이렇게 위에 정리하는 것이 습관이 안 된 경우 개발시간을 늘려버리는 불편함이 생겨버리게 된다. 하지만, 자바스크립트 개발자라면 이를 습관화 들이면 좋은 핵심적인 이유가 하나 남아있는데, 바로 'minification에 유리'하다는 점이다. 이 점은 특히 다른 개발 언어에서는 이렇게 변수를 선언하는 것이 중요하지 않지만 '자바스크립트'에서 특별히 더 중요하게 적용되는 이유이다. Minification에 대해서 나중에 최적화에 대한 글을 쓸 때 쯤에 더 자세하게 다루겠지만, 이는 소스의 사이즈를 줄여서 사용자가 다운로드 받아야 하는 양을 최소화 시키는 프로세스이다.
    - 소스보기로 자바스크립트의 코드를 봐왔다면 이러한 식의 자바스크립트 코드를 왕왕 봐왔을 것이다. 이것은 자바스크립트 코드의 보안(암호화)를 위한 목적도 '아주 조금' 있지만, 더 큰 이유는 바로 이렇게 소스의 크기를 최대한 줄여서 사용자가 다운 받는 용량을 최소화하여 성능 최적화를 위한 것이다.
    - 두 개의 결과는 직접적인 소스의 차이보다는 일단 minify 전과 minify 후의 용량을 비교해보면 그 효율의 차이가 있음을 알 수 있을 것이다. 아래의 표를 살펴보면, var로 정리하는 것이 minify 전에는 용량이 더 컸으나, minification을 적용한 후에는 미세하지만 더 작아진 것을 확인할 수 있다. 이것은 상단에 var를 정리하는 것이 minification의 효율을 더 끌어올릴 수 있다는 것을 뜻하기도 한다.
    - 이렇게 var 변수로 상단에 정의하면 좋은 이유가 하나 더 있는데, 초기화와 관련해서 다음 편에 또 이렇게 변수를 관리하는 경우 편리한 점을 하나 더 설명할 것이다. 이 또한 성능과 관련하여 관리하기 편하게 할 수 있는 관점으로 볼 수 있을 것이다. 이렇게 성능을 고려한 몇 가지 이유들이 이러한 식으로 변수를 선언하는 것이 조금 더 유리하다는 것을 뜻한다.
- 이전에도 썼지만, 자바스크립트 개발자와 평범한 웹프로그래머의 차이는 이러한 미미한 것들부터 하나씩 차이가 나는 것이므로, 항상 습관을 들여서 사용하지는 않더라도, 머리 속에는 언제나 염두해주자. 이러한 minification에 대해서도 나중에 이야기 하겠지만, minification을 실시하고 있는 웹사이트들도 사실은 대형 사이트가 아니면 극히 드물다.

## 글로벌 변수 최소화하기

- 그럼 이제 다시 변수 선언에 대한 내용으로 돌아와서, 글로벌 변수의 사용을 최소화할 수 있는 가장 많이 쓰이는 방법들을 살펴보자. 사실 이 내용은 다음 글에서 다루려고 했는데, 다음에 다룰 '성능을 고려한 변수 선언'의 내용이 좀 많은 내용을 다루게 될 것 같아서, 이번에 다루고 다음에는 성능에 대한 부분을 더 집중해서 다뤄보도록 하겠다. 일단 글로벌 변수의 사용을 최소화하는 방법은 크게 두 가지를 많이 사용한다. 먼저 두 가지 방법에 대해서 예를 살펴보고, 각각 어떠한 상황에서 사용하면 되는지 알아보자.
  - Closure를 이용하는 방법
  - Module/Namespace 패턴을 사용하는 방법
- 각각의 방식을 선택할 때에는 몇가지를 고려하면 되는데, 몇가지 대표적으로 꼽으면 아래와 같다.
  - DOM에서 접근해서 사용해야한다 -> Module 방식
  - 내부에 있는 값을 DOM에서 사용한다 -> Module 방식
  - 다른 사람과 공유하는 공통 라이브러리로 사용하고 싶다 -> Module 방식
  - 외부에서 접근할 일이 없다 -> Closure 방식
  - 잘 모르겠다 -> Closure 방식
  - 이 데이터는 보안이 중요하다 -> 처음부터 자바스크립트로 가져오지 말 것
- Closure는 정상적인 방법으로 거의 모든 데이터의 접근을 막을 수 있지만, 어찌되었든 보안이 중요한 데이터는 서버에서 다 처리하는 것이 제일 좋다. 웹의 브라우져는 클라이언트 사이드에 100% 다 있기 때문에 자바스크립트를 사용하는 모든 데이터는 클라이언트의 손안에 있다고 보면 되기 때문에, 이러한 점은 나중에 논리 모델을 설계할 때 라던가 미리 고려를 하면 좋을 것이다.

## 정리

- 가능하면 var는 scope가 생성되는 상단에 하나로 몰아서 쓰자
- 자바스크립트 파일은 minification을 해서 사용하자
- 글로벌 변수 사용을 최소화하기 위하여 closure 또는 module을 사용하자

출처: https://unikys.tistory.com/329 [All-round programmer]
