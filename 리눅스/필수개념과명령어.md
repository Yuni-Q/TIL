
# 서버를 구축할 때 알아야 할 필수 개념과 명령어

## 터미널/콘솔에서 시스템 종료 명령 실행
- shutdown -P now
- halt -p
- init 0
> -P와 -p 옵션은 시스템 종료를 의미한다.  
> 유닉스/리눅스에서는 대문자와 소문자를 구분한다.  
> # : root 사용자  
> $ : 일반 사용자  

## 시스템 재부팅
- shutdown -r now
- reboot
- init 6

## 로그아웃
- logout
- exit

## 런레벨
|런레벨|영문 모드|설명|비고|
|----|-------|---|---|
|0|Power Off|종료 모드||
|1|Rescue|시스템 복구 모드||
|2|Multi-User||사용하지 않음|
|3|Multi-User|텍스트 모드의 다중 사용자 모드||
|4|Multi-User||사용하지 않음|
|5|Graphical|그래픽 모드의 다중 모드||
|6|Reboot||||
> 일반적으로 런레벨 3번을 Multi-User 모드로 사용한다. 2번과 4번은 CentOS 7에서는 사용하지 않지만 호환성을 위해서 런레벨 3번과 동일한 것으로 취급한다.  

## 히스토리
- history : 사용했던 명령을 오묻 볼 수 있다.
- history c : 기억되었던 명령어를 모두 삭제 한다.

## vi
- :q : 종료 한다.
- I or A : 글자를 입력(Insert)하거나 추가(Append) 한다.
- :wq : 저장(Write)하고 종료(Quit) 한다.
- :q! : 기존의 병견된 내용을 무시하고 종료한다.
> 스왑 파일(swap file)이 존재한다는 것은 앞에서 수정 작업이 정상적으로 종료되지 않았다는 것을 알려 줍니다.  
> ex) .파일 이름.swp

### 명령 모드에서 입력 모드로 전환하는 키
|키|설명|키|설명|
|-|---|-|---|
|i|현재 커서의 위치부터 입력(I)|I|현재 커서 줄의 맨 앞에서 부터 입력(Shift + I)|
|a|현재 커서의 위치 다음 칸부터 입력(A)|A|현재 커서 줄의 맨 마지막부터 입력(Shift + A)|
|o|현재 커서의 다음 줄에 입력(O)|O|현재 커서의 이전 줄에 입력(Shift + O)|
|s|현재 커서 위치의 한 글자를 지우고 입력(S)|S|현재 커서의 한 줄을 지우고 입력(Shift + S)|

### 명령 모드에서 커서를 이동할 때 사용하는 키
|키|설명|키|설명|
|-|---|-|---|
|h|커서를 왼쪽으로 한칸 이동(<-와 같은 의미, H)|j|커서를 아래로 한칸 이동(J)|
|k|커서를 위로 한칸 이동(K)|l|커서를 오른쪽으로 한칸 이동(->와 같으 의미, l)|
|Ctrl + F|다음 화면으로 이동(Page Down과 같은 의미)|Ctrl + B|이전 화면으로 이동(Page Up과 같은 의미)|
|^|현재 행의 처음으로 이동(Home과 같은 의미, Shift + 6)|$|현재 행의 마지막으로 이동(End와 같은 의미, Shift + 4)|
|gg|제일 첫 행으로 이동|G|제일 끝 행으로 이동(Shift + G)|
|숫자 G|해당 숫자의 행으로 이동(숫자 다음 Shift + G|:숫자|해당 숫자의 행으로 이동|

### 명령 모드에서 삭제, 복사, 붙여 넣기 관련 키
|키|설명|키|설명|
|-|---|-|---|
|x|현재 커서가 위치한 글자 삭제(Del과 같은 의미, X)|X|현재 커서가 위치한 앞 글자 삭제(BackSpace와 같은 의미, Shift + X)|
|dd|현재 커서의 행 삭제(D 연속 두번 입력)|숫자 dd|현재 커서부터 숫자만큼의 행 삭제(숫자 다음 D 연속 두번 입력)|
|yy|현재 커서가 있는 행을 복사(Y 두번 연속 입력)|숫자 yy|현재 커서부터 숫자만큼의 행을 복사(숫자 다음 Y 두번 연속 입력)|
|p|복사한 내용을 현재 행 이후에 붙여 넣기(P)|P|복사한 내용을 현재 행 이전에 붙여 넣기(Shift + P)|

### 명령 모드에서 문자열 찾기
|키|설명|키|설명|
|-|---|-|---|
|/문자열 Enter|해당 문자열을 찾음(현재 커서 이후로)|n|찾은 문자 중에서 다음 문자로 이동(N)|
|:%s/기존문자열/새문자열/|문자열 치환|:.set number|행 번호 표시|

### 도움말 사용법
- man : manual의 약어로, 리눅스에 포함된 체계화된 도움말이다.  

#### man 명령어는 섹션을 1~9까지 9개 페이지로 나눈다.
- 1 : 명령어   
- 2~3 : 프로그래밍
- 4 : 디바이스
- 5 : 파일 형식
- 6 : 게임
- 7 : 기타 주제
- 8 : 시스템 관리
- 9 : 커널 관련 설명

## 리눅스 기본 명령어

### whoami
현재 사용자가 누군인지 알려준다.  

### ls
List의 약자로 Windows의 dir과 같은 역할을 한다.  
즉, 해당 디렉터리(=폴더)에 있는 파일의 목록을 나열 한다.
- ls : 현재 디렉터리의 파일 목록
- ls -a : 현재 디렉터리의 목록(숨김 파일 포함)
- ls -l : 현재 디렉터리의 목록을 자세히 보여줌
> 리눅스는 숨김 파일(hidden file)이라는 속성이 별도로 존재하지 않는다.  
> 파일 이름이나 제일 앞 글자를 .으로 하면 자동으로 숨김 파일이 된다.  

### cd
Change Directory의 약자로 디렉터리를 이동하는 명령이다.  
- .(현재 디렉터리)
- ..(현재 디렉터리의 상위 디렉터리)

### pwd
Print Working Directory의 약자로 현재 디렉터리의 전체 경로를 화면에 보여준다.  

### rm
ReMove의 약자로 파일이나 디렉터리를 삭제한다.  
당연히 파일이나 디렉터리를 삭제할 권한이 있어야 한다.  
단, root 사용자는 모든 권한이 있으므로 이 명령어에 제약이 없다.  
- rm abc.txt : 해당 파일을 삭제(내부적으로 rm -i로 연결 됨)
- rm -i abc.txt : 삭제 시 정말 삭제할지 확인하는 메세지가 나옴
- rm -f abc.txt : 삭제 시 확인하지 않고 삭제(f는 Force의 약자)
- rm -r abc : 해당 디레거리를 삭제(r은 Recursive의 약자)
- rm -rf abc : r 옵션과 f 옵션을 합친 것으로, abc 디렉터리와 그 아래에 있는 하위 디렉터리를 강제로 전부 삭제(편리하지만 상당히 주의해서 사용해야 함)

### cp
Copy의 약자로 파일이나 디렉터리를 복사한다.  
새로 복사한 파일은 복사한 사용자의 소유가 된다.  
그러므로 명령어를 실행하는 사용자는 해당 파일의 읽기 권한이 필요하다.  
- cp abc.txt cba.txt : abc.txt를 cba.txt라는 이름으로 바꿔서 복사
- cp -r abc cba : 디렉터리 복사

### touch
크기가 0인 새 파일을 생성하거나, 이미 파일이 존재한다면 파일의 최종 수정 시간을 변경한다.  

### mv
- mv abc.txt /etc/sysconfig/ : abc.txt을 /etc/sysconfog/ 디렉터릴로 이동
- mv aaa bbb ccc ddd : aaa, bbb, ccc 파일을 /ddd 디렉터리로 이동
- mv abc.txt www.txt : abc.txt의 이름을 www.txt로 변경해서 이동

### mkdir
Make DIRectory의 약자로 새로은 디렉터리 생성한다.  
생성된 디렉터리는 명령어를 실행한 사용자의 소유가 됨  

### rmdir
ReMove DIRectory의 약자로 디렉터리를 삭제한다.  
해당 디렉터리의 삭제 권한이 있어야 하며, 디렉터리는 비어 있어야 한다.  
파일이 들어 있는 디렉터리를 삭제하려면 -rm -r을 실행해야 한다.  

### cat
conCATenate의 약자로 파일의 내용을 화면에 보여준다.  
여러 개 파일을 나열하면 파일을 연결해서 보여준다.  

### head, tail
텍스트 형식으로 작성된 파일의 앞 10행 또는 마지막 10행만 화면에 출력한다.  

### more
텍스트 형식으로 작성된 파일을 페이지 단위로 화면에 출력한다.  
Space를 누르면 다음 페이지로 이동하며, B를 누르면 앞 페이지로 이동한다.  
Q를 누르면 종료한다.  

### less
more 명령어와 용도가 비슷하지만 기능이 더 확장되어 있다.  
more에서 사용하는 키도 사용 할 수 있으며, 화살표 키나 Page Up, Page Down도 사용 할 수 있다.  

### file
해당 파일이 어떤 종류의 파일인지를 표시해 준다.  

### clear
현재 사용중인 터미널 화면을 깨끗하게 지워준다.  

## 사용자 관리와 파일 속성

### 사용자와 그룹
/etc/passwd
사용자 이름:암호:사용자ID:사용자가 소속된 그룹 ID:전체 이름:홈 디렉터리:기본 셀  
> root 사용자는 사용자 id와 그룹 id가 0번으로 설정 되어 있다.  

#### useradd (또는 adduser)
새로운 사용자를 추가한다.  
이 명령어를 실행하면 /etc/passwd, /etc/shadow, /etc/group 파일에 새로운 행이 추가 된다.  
- useradd newuser : newuser라는 이름의 사용자 생성
- useradd -u 1111 newuser : newuser 사용자를 생성하면서 사용자 ID를 1111로 지정
- useradd -g mygroup newuser : newuser 사용자를 생성하면서 mygroup 그룹에 newuser 사용자를 포함 시킴(mygroup 그룹을 먼저 만들어 놓아야 함)  
- user add -d /newhome newuser : newuser 사용자를 생성하면서 홈 디렉터리를 /newhome으로 지정
- useradd -s /bin/csh newuser : newuser 사용자를 생성하면서 기본 셀을 /bin/csh로 지정   

#### passwd
사용자의 비밀번호를 지정하거나 변경한다.  

#### usermod
사용자의 속성을 변경한다.  
옵션은 useradd와 동일하다.  

#### userdel
사용자를 삭제한다.  
- userdel -r newuser : newuser 사용자를 삭제하면서 홈 디렉터리까지 삭제  

#### chage
사용자의 암호를 주기적으로 변경하도록 설정한다.  
- chage -l newuser : newuser 사용자에 설정된 사항을 확인  
- chage -m 2 newuser : newuser 사용자에 설정한 암호를 사용해야 하는 최소일자(즉, 변경 후 최소 2일은 사용해야 함)
- chage -M 30 newuser : newuser 사용에 설정한 암호를 사용할 수 있는 최대일자(즉, 변경 후 최대 30일까지 사용할 수 있음)
- chage -E 2019/12/12 newuser : newuser 사용자에 설정한 암호가 만료되는 날짜(즉, 2019/12/12까지만 사용할 수 있음)
- chage -W 10 newuser : newuser 사용자에 설정한 암호가 만료되기 전에 경고하는 기간. 지정하지 않았을 경우 기본 값은 7일(즉, 암호가 만료되기 10일 전부터 경고 메시지가 나감)

#### groups
사용자가 소속된 그룹을 보여준다.  
- groups : 현재 사용자가 소속된 그룹을 보여줌
- groups newuser : newuser가 소소된 그룹을 보여줌

#### groupadd
새로운 그룹을 생성한다.  
- groupadd newgroup : newgroup이라는 그룹을 생성
- groupadd -g 2222 newgroup : newgroup 그룹을 생성하면서 그룹 ID를 2222로 지정  

#### groupmod
그룹의 속성을 변경한다.  
- groupmod -n newgroup mygroup : newgroup 그룹의 이름을 mygroup으로 변경

#### groupdel
그룹을 삭제한다.  

#### gpasswd
그룹의 암호를 설정하거나 그룹 관리를 수행한다.  
- gpasswd newgroup : newgroup 그룹의 암호를 지정
- gpasswd -A newuser newgroup : newuser 사용자를 newgroup 그룹의 관리자로 지정
- gpasswd -a user1 newroup : user1을 newgroup 그룹의 사용자로 추가
- gpasswd -d newuser newgroup : user1을 newgroup 그룹의 사용자에서 제거

### 파일과 디렉터리의 소유와 허가권
|-|rw-r--r--|1|root|root|0|12월 1 20:54|sample.txt|
|-|---------|-|----|----|-|------------|----------|
|파일 유형|파일 허가권|링크 수|파일 소유자 이름|파일 소유 그룹 이름|파일 크기(Byte)|마지막 변경 날짜/시간|파일 이름|

#### 파일 유형
d : 디렉터리  
\- : 일반적인 파일  
b : 블록 디바이스(하드디스크, 플로피 디스크, CD/DVD 등의 저장 장치)  
c : 문자 디바이스(마우스, 키보드, 프린터 등의 입출력 장치)  
l : 링크(Windows의 바로가 가기 아이콘과 비슷한 개념으로 연결된 파일을 의미한다. 이때 실제 파일은 다른 곳에 존재함을 기억하자)  

#### 파일 허가권
r : read  
w : write  
x : execute  

1번째는 소유자의 파일 접근 권한  
2번째는 그룹의 파일 접근 권한  
3번째는 그 외 사용자의 파일 접근 권한

|r|w|-|r|-|-|r|-|-|
|-|-|-|-|-|-|-|-|-|
|4|2|0|4|0|0|4|0|0|
||6|||4|||4||
> 파일의 허가권을 변경하는 명령어로는 chmode가 있다.  
> 이 명령어는 root 사용자 또는 해당 파일의 소유자만이 실행할 수 있다.  
> chmod 명령어를 상대 모드로도 사용 할 수 있다.  

Windows의 경우 확장명으로 해당 파일의 종류를 판단하지만, 리눅스는 확장자에 별 의미를 두지 않는다.  
즉, 실행파일이건 텍스트 파일이건 모두 일반적으로 확장명을 갖지 않는다.  
그래서 해당 파일이 어떤 파일인지를 알려면 file 명령어를 사용해야 한다.  

#### 파일 소유권
파일 소유권은 파일을 소유한 사용자와 그룹을 의미한다.  
chown으로 파일의 소유권을 변경 할 수 있다.  
- chown coentos sample.txt : 파일의 소유자를 centos로 바꾸어라
- chown centos.centos sample.txt : 파일의 그룹도 centos 그룹으로 바꾸어라
- chgrp centos sample.txt : 그룹만 centos 그룹으로 변경 하라.


#### 링크
하드 링크, 심볼링 링크 2가지가 있다.  
하드 링크를 생성 하려면 'ln 링크대상파일이름 링크파일이름'을 실행한다.  

> inode는 리눅스 유닉스 파일 시스템에서 사용하는 자료구조를 말하는데, 파일이나 디렉터리의 여러가지 정보가 있다.  
> 모든 파일이나 디렉터리는 각자 1개씩의 inode가 있으며, 각 inode에는 해당 파일의 소유권, 허가권, 파일 종류 등의 정보와 해당 파일의 실제 데이터가 어디에 있는지 위치(=주소)도 있다.  
> 이런한 inode가 모여 있는 공간이 inode 블록이며, 일반적으로 전체 디스크의 1% 정도를 차지한다.  
> Data 블록은 실제 데이터가 저장되어 있는 디스크 공간으로 전체 디스크의 대부분을 차지한다.  

원본에 심볼릭 링크를 생성하면 새로운 inode2를 만들고, 데이터는 원본 파일과 연결되는 효과를 갖는다.  
심볼링 링크를 생성하려면 'ln -s 링크대상파일이름 링크파일이름'을 실행한다.  

하드 링크는 디렉터리에서 원본 파일이 없어져도 아무런 이상이 없고, 심볼릭 링크는 디렉터리에서 원본 파일이 없어지면 연결이 끊어진다.(다시 원본 파일을 현재 디렉터리에 가져와서 다시 한번 확인해보면 심볼릭 링크가 원상태로 복구되었음을 확인 할 수 있다.)  

## 리눅스 관리자를 위한 명령어

### 프로그램 설치를 위한 RPM
CentoOS에서 패키지(프로그램)를 설치하는 데 가장 많이 사용되는 것이 RPM과 YUM이다.  
YUM이 별도로 존재한다기보다는 RPM을 포함한 확장 개념에 가까우므로 먼저 RPM의 개념을 익혀야 한다.  

확장자명은 *.rpm이며, 이를 패키지라고 부른다.  

강제로 패키지를 설치하는 --force 옵션과 의존성을 무시하고 설치하는 --nodeps 옵션도 사용할 수 있으나, 이러한 옵션은 정상 설치를 보장할 수 없으므로 주의해서 사용해야 한다.  

#### 자주 사용하는 rpm 명령어 옵션

##### 설치
rpm -Uvh 패키지파일이름.rpm
-  대문자 U : 기존에 패키지가 설칟되지 않았다면 일반적인 설치를 하고, 기존에 패키지가 설치되어 있다면 업그레이드를 한다.(i 옵션은 설치되어 있다면 오류가 발생하므로, U 옵션이 더 편하다)  
- v : 설치 과정 확인  
- h : 설치 진행 과정을 # 기호로 화면에 출력

##### 삭제
rpm -e 패키지 이름
- e : erase(지움)의 약자  

##### 이미 설치된 패키지 조회
rpm -qa 패키지이름 : 시스템에 패키지가 설치되었는지 확인  
rpm -qf 파일절대경로 : 이미 설치된 파일이 어느 패키지에 포함된 것인지 확인  
rpm -ql 패키지이름 : 특정 패키지에 어떤 파일들이 포함되었는지 확인  
rpm -qi 패키지이름 : 설치된 패키지의 상세 정보  

##### 아직 설치되지 않은 rpm 파일 조회
rpm -qlp 패키지파일이름.rpm : 패키지 파일에 어떤 파일들이 포함되었는지 확인  
rpm -qip 패키지파일이름.rpm : 패키지 파일의 상세 정보  

#### RPM의 단점
의존성 문제  

### 편리하게 패키지를 설치하는 YUM
YUM은 RPM과 별로라기 보다는 rpm 패키지를 설치하는 편리한 도구라고 생각하면 된다.  
yum 명령어는 rpm 명령어의 패키지 의존성 문제를 완전하게 해결해준다.  

#### 기본 설치 방법
yum -y install 패키지이름
- -y 옵션을 써주면 사용자에게 yes/no를 묻는 부븐이 무조건 yes를 입력한 것으로 간주하고, 자도응로 넘어가서 편리하다.  

#### rpm 파일 설치 방법
yum localinstall rpm파일이름.rpm
- rpm -Uvh 대신 사용합니다.  

#### 업데이트 가능한 목록 보기
yum check-update

#### 업데이트
yum update

#### 삭제
yum remove 패키지이름

#### 정보 확인
yum info 패키지이름  

#### 패키지 그룹 설치
yum groupinstall "패키지그룹이름"
- 패키지 그룹에 포함되는 패키지들을 통쨰로 성치할 때 사용 할 수 있다.
- 종류는 yum grouplist으로 확인 할 수 있다.
- 설치할 때 그룹의 이름은 주로 띄어쓰기가 많으므로 꼭 "" 안에 써야 한다.  

#### 패키지 리스트 확인
yum list 패키지이름

#### 특정 파일이 속한 패키지 이름 확인
yum provides 파일이름

#### GPG 키 검사 생략
yum install --nogpgcheck rpm파일이름.rpm

#### 기존 저장소 목록 지우기
yum clean all

#### YUM의 작동 방식과 설정 파일
1. yum install 입력
1. /etc/yum.repos.d/ 디렉터리의 repo 파일을 열어서 URL 주소 확인
1. 전체 패키지 목록 파일을 요청
1. 전체 패키지 목록 파일만 다운로드
1. 설치할 패키지와 관련된 패키지의 이름을 화면에 출력
1. y를 입력하면 서치에 필요한 패키지 파일을 요청함
1. 설치할 패키지 파일을 다운로드해서 자동 설치

## 파일의 압축과 묶기

### 파일 압축
리눅스에서 많이 보는 압축 파일의 확장자명으로는 xz, bz2, gz, zip, Z 등이 있다.  
예전에는 주로 확장면 gz를 사용했으나, 최근에는 압축률이 더 좋은 xz나 bz2를 더 많이 사용하는 추세다.  

#### xz
확장명 xz로 압축하거나 풀어준다.  
비교적 최신의 압축 명령으로 압축률이 뛰어나다.  

- xz 파일이름 : 파일이름을 압축파일인 파일이름.xz로 만든다. 기존 파일은 삭제됨  
- xz -d 파일이름.xz : 파일이름.xz 압축 파일을 일반 파일인 파일이름으로 만듦(d는 Decompress의 의미)   
- xz -l 파일이름.xz : 파일이름.xz 압축 파일에 포함된 파일 목록과 압축률 등을 출력(l은 List의 의미)    
- xz -k 파일이름.xz : 압축 후에 기존 파일을 삭제하지 않고 그대로 둠(k는 Keep의 의미)  















