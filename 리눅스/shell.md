
# Shell

## 셸의 기본
명령어를 입력하는 환경  
사용자가 입력한 명령을 해석해 커널에게 전달하거나, 커널의 처리 결과를 사용자에게 전달하는 역할  

### CentOS의 bash 셸
CentOS에서 기본적ㅇ로 사용하는 셸은 bash(Boume Again SHell)이다.  
Bourne Shell을 기반으로 Korn Shell과 C Shell의 좋은점을 합한 것으로 보면 된다.  

- Alias 기능(명령어 단축 기능)
- History 기능
- 연산 기능
- Job Control 기능
- 자동 이름 완성 기능(Tab)
- 프롬프트 제거 기능
- 명령 편집 기능

### 셸의 명령문 처리 방법
(프롬프트) 명령어 [옵션...] [인자...]

### 환경 변수
셸은 여러 가지 환경 변수 값을 갖는데, 설정된 환경 변수는 echo $환경 변수이름 형식으로 명령어를 실행하면 확인할 수 있다.  
|환경 변수|설명|환경 변수|설명|
|-------|---|------|---|
|HOME|현재 사용자의 홈 디렉터리|PATH|실행 파일을 찾는 디렉터리 경로|
|LANG|기본 지원되는 언어|PWD|사용자의 현재 작업 디렉터리|
|TERM|로그인 터미널 타입|SHELL|로그인해서 사용하는 셸|
|USER|현재 사용자 이름|DISPLAY|X 디스플레이 이름|
|COLUMNS|현재 터미널의 칼럼 수|LINES|현재 터미널 라인 수|
|PS1|1차 명령 프롬프트 변수|PS2|2차 명령 프롬프트(대게는 '>')|
|BASH|bash 셸의 경로|BASH_VERSION|bash 버전|
|HISTFILE|히스토리 파일의 경로|HISTSIZE|히스토리 파일에 저장되는 개수|
|HOSTNAME|호스트의 이름|USERNAME|현재 사용자의 이름|
|LOGNAME|로그인 이름|LS_COLORS|'ls' 명령어의 확장자 색상 옵션|
|MAIL|메일을 보관하는 경로|OSTYPE|운영체제 타입|

환경 변수 값을 변경하려면 'export 환경변수=값 형식을 실행한다.  
그 외의 환경 변수는 printenv 명령어를 실행하면 출력된다.  
단, 일부 환경 변수는 나타나지 않는다.  

## 셸 스크립트 프로그래밍 실습
리눅스의 셸 스크립트는 C 언어와 유사한 방법으로 프로그래밍할 수 있다.  
셸 스크립트도 일반적인 프로그래밍 언어와 비슷하게 변수, 반복문, 제어문 등을 사용할 수 있다.  
별도로 컴파일하지 않고 텍스트 파일 형태로 셸에서 바로 실행할 수 있다.  
vi나 gedit 활용  

주석 : #  
echo : 화면에 출력
exit 0 : 종료 코드를 반환한다. 셸 스크립트는 실행 중간에 문제가 생겨도 무조건 성공했다는 메시지를 반환하기 때문에, 직접 마지막 행에서 성공인지 실패인지를 반환하는 것이 좋다. 0은 성공을 의미한다.  

- sh 명령어로 실행
- 실행 가능 속성으로 변경한 후 실행. chmod +x 파일명은 파일의 속성에 실행 가능 속성을 추가하라는 의미다. 변경 후 './스크립트파일'을 실행한다.  

### 변수

#### 변수의 기본
- 셸 스크립트에서는 변수를 사용하기 전에 미리 선언하지 않으며, 처음 변수에 값이 할당되면 자동으로 변수가 생성된다.  
- 변수에 넣은 모든 문자열(String)로 취급한다. 즉, 숫자를 넣어도 문자로 취급한다.  
- 변수 이름은 대소문자를 구분한다. 즉 $aa라는 변수 이름과 $AA라는 변수 이름은 다르다.
- 변수를 대잉ㅂ할 때 '=' 좌우에는 공백이 없어야 한다.

#### 변수의 입력과 출력
'$'라는 문자가 들어간 글자를 출력하려면 ''로 묶어주거나 앞에 '/'를 붙여야 한다.  
""로 변수를 묶어도 되고, 묶지 않아도 된다.  

#### 숫자 계산
연산을 하려면 expr 키워드르 사용한다.  
역따옴표(`)로 묶어야 한다.  
수식에 괄호를 사용하려면 역슬래시(\)를 붙여줘야 한다.  
곱하기(*) 기호도 예외적으로 앞에 역슬래시를 붙여줘야 한다.  

#### 파라미터 변수
'$0', '$1', '$2' 등의 형태를 갖는다.  
실행하는 명령의 부분 하나한를 변수로 지정한다는 의미다.  

### if문과 case문

#### 기본 if문
```sh
if [ 조건 ]
then
  참일 경우 실행
fi
```
> [ 조건 ] 사이의 각 단어에는 모두 공백이 있어야 한다는 것이다.  
> '[ ]' 대신 test라는 키워드를 사용할 수도 있다.  

#### if else문
```sh
if [ 조건 ]
then
  참일 경우 실행
else
  거짓일 경우 실행
if
```

#### 조건문이 들어가는 비교 연산자
문자열 비교 연산자와 산술 비교 연산자가 있다.  
|문자열과 비교|결과|
|---------|---|
|"문자열1" = "문자열2"|두 문자열이 같으면 참|
|"문자열1" != "문자열2"|두 문자열이 같지 않으면 참|
|-n "문자열"|문자열이 NULL(빈 문자열)이 아니면 참|
|-z "문자열"|문자열이 NULL(빈 문자열)이면 참|

|산술 비교|결과|
|------|---|
|수식1 -eq 수식2|두 수식(또는 변수)이 같으면 참|
|수식1 -ne 수식2|두 수식(또는 변수)이 같지 않으면 참|
|수식1 -gt 수식2|수식1이 크다면 참|
|수식1 -ge 수식2|수식1이 크거나 같으면 참|
|수식1 -lt 수식2|수식1이 작으면 참|
|수식1 -le 수식2|수식1이 작거나 같으면 참|
|!수식|수식이 거짓이라면 참|

#### 파일과 관련된 조건
|파일 조건|결과|
|-------|---|
|-d 파일이름|파일이 디렉터리면 참|
|-e 파일이름|파일이 존재하면 참|
|-f 파일이름|파일이 일반 파일이면 참|
|-g 파일이름|파일이 set-group-id가 설정되면 참|
|-r 파일이름|파일이 읽기 가능하면 참|
|-s 파일이름|파일 크기가 0이 아니면 참|
|-u 파일이름|파일에 set-user-id가 설정되면 참|
|-w 파일이름|파일이 쓰기 가능 상태이면 참|
|-x 파일이름|파일이 실행 가능 상태이면 참|

#### case-esac문
다중 분기  
```sh
#!/bin/sh
case "$1" in
  start)
    echo "시작";;
  stop)
    echo "중지";;
  restart)
    echo "다시시작";;
  yes | y | Y | YES)
    echo "다행입니다";;
  [nN]*)
    echo "안타깝네요";;
  *)
    echo "뭔지 모름";;
esac
exit 0
```
> 맨 뒤에 세미콜론 2개(;;) 붙여서 써야 한다.  

#### AND, OR 관계 연산자
and는 -a 또는 &&fmf 사용한다.  
or은 -o 또는 ||를 사용한다.  
-a나 -o는 테스트문([]) 안에서 사용할 수 있는데, 이 때 괄호 등의 특수 문자 앞에는 역슬래시(\)를 붙여줘야 한다.  

### 반복문

#### for~in문
```sh
for 변수 in 값1 갑2 값3 ... ... ...
do
  반복할 문장
done
```

#### while
```sh
#!/bin/sh
while [ 1 ]
do
  echo "CentOS 7"
done
exit 0
```
> 취소 Ctrl + c  

##### 비밀번호 맞는지 TEST
```sh
#!bin/sh
echo "비밀번호를 입려하세요."
read mypass
while [ $mypass != "1234" ]
do
  echo "틀렸음. 다시 입력하세요."
  read mypass
done
echo "통과"
exit 0
```

#### until문
조건이 참일 떄까지(=거짓인 동안) 계속 반복한다.  

#### break, continue, exit, return
- break : 주로 반복문을 종료할 때 사용  
- continue : 반복문의 조건식으로 돌아가게 한다.  
- exit : 해당 프로그램을 완전히 종료한다.  
- return : 함수 안에서 사용될 수 있으며 함수를 호출한 곳으로 돌아가게 된다.  

### 기타 알아둘 내용

#### 사용자 정의 함수
```sh
#!bin/sh
myFunction () {
  echo "함수 안으로 들어 왔음"
  return
}
echo "프로그램을 시작합니다."
myFunction # 함수 실행
echo "프로그램을 종료합니다."
exit 0
```

#### 함수의 파라미터 사용
```sh
#!bin/sh
hap () {
  echo 'expr $1 + $2'
}
echo "10 더하기 20을 실행합니다."
hap 10 20
exit 0
```

#### eval
문자열을 명령문으로 인식하고 실행한다.  

#### export
외부로 변수를 선언한다.  
다른 프로그램에서도 사용할 수 있게 한다.  

#### printf
C 언어의 printf() 함수와 비슷하게 형식을 지정해서 출력할 수 있다.  

#### set과 $(명령어)
명령어를 결과로 사용하려면 $(명령어) 형식을 사용해야 한다.  
결과를 파라미터로 사용하고자 할 때는 set 명령어와 함께 사용한다.  

#### shift
파라미터 변수를 한 단계씩 아래로 쉬프트(이동) 시킨다.  
모든 파라미터 변수를 출력하고 싶거나, 특히 10개가 넘는 파라미터 변수에 접글할 때 사용한다. 단 $0 파라미터 변수는 변경되지 않는다.  
```sh
#!/bin/sh
myfunc () {
  str=""
  while [ "$1" != "" ] ; do
    str="$str $1"
    shift
  done
  echo $str
}
myfunc AAA BBB CCC DDD EEE FFF GGG HHH III JJJ KKK
exit 0
```

---
참조 : [이것이 리눅스다](https://book.naver.com/bookdb/book_detail.nhn?bid=9219952)
