
# 인프라를 지탱하는 응용 이론

## 캐시(cache)
- 숨기는 장소라는 의미가 있다.  
- 컴퓨터 세계에서 캐시는 사용 빈도가 높은 데이터를 고속으로 액세스할 수 있는 위치에 두는 것을 의미한다.  
- 캐시는 임시 저장소를 의미한다.

- 일부 데이터를 데이터 출력 위치와 가까운 지점에 일시적으로 저장한다.
- 데이터 재사용을 전체로 한다.

- 데이터를 소속으로 액세스 할 수 있다.
- 실제 데이터에 대한 액세스 부하를 줄일 수 있다.

- 일상 생활에서 아무거나 가까운 곳에 쌓아 두면 정리가 귀찮아지듯이, 캐시에도 적합한 데이터와 주의할 점이 있다.
- 캐시는 고속으로 액세스할 수 있지만, 데이터를 잃을 위험이 있어서 캐시 데이터가 손실돼도 괜찮은 경우에 주로 사용한다.

### 적합한 시스템
- 참조 빈도가 높은 데이터
- 캐시의 데이터가 손실돼도 문제가 없는 시스템

### 부적합한 시스템
- 데이터 갱신 빈도가 높은 시스템
- 대량의 데이터에 액세스하는 시스템

### -
- 데이터가 실제 데이터와 캐시라는 이중 구조로 저장되기 때문에 리소스 소비가 늘어난다. 설계 시에는 어떤 데이터를 캐시하는 것이 효과적인지를 검토해야한다.
- 시스템 가동 직후 등에는캐시에 데이터가 없기 때문에 원하는 성능이 나오지 않을 수 있다.
- 캐시 계층이 늘어나기 때문에 시스템 성능 문제나 데이터 불일치 문제가 발생한 경우는 문제 발생을 야기한 용의자가 늘어난다.
- 캐시의 데이터가 손실되는 경우를 대비해서 복구 순서를 설계 시에 확립해야 한다.
- 갱신 데이터(쓰기 데이터)를 캐시할 때 캐시가 여러 개 있으면 갱신된 최신 데이터를 서로 뺏으려는 상태가 발생하지 않도록 주의해야 한다

## 끼어들기
- 급한 일을 먼저 하도록 CPU에 알리는 중요한 역할을 한다.
- 끼어들기보다는 주로 인터럽트(interrupt)라고 많이 부르는데, 이 책에서는 끼어들기나 중단의 의미로서 끼어들기로 표기하고 있다.
- 애플리케이션이 처리를 하고 있는 동안 키보드를 누르면 문자가 입력되지만, 이것은 끼어들기 처리에 의한 것이다.

- 끼어들기는 급한 일이 생겨서 지금 진행 중인 일을 중단하고 급한 일을 끝낸 후에 다시 원래 일을 진행하는 것이다. 일하는 동안에 전화가 와서 일을 중단하고 전화를 받은 후 다시 하던 일을 진행하는 것과 같다.
- 구체적으로는 키보드 입력 등의 특정 이벤트가 발생했을 때 CPU에 이것을 알려서 해당 이벤트에 대응하는 처리를 끝낸 후 원래 하던 처리를 계속하는 것이다.

- 프로세스나 스레드가 허가되지 않은 메모리 위치에 액세스하려고 하면, 조각화(segmentation) 위한이라 불리는 예외가 발생해서 OS에 의해 프로세스가 강제 종료된다. 이것도 끼어들기의 일종으로, 예외나 소프투웨어 끼어들기 등으로 불린다.

- 끼어들기는 어떤 일이 발생하면 연락하는 이벤트 주도 구조다.
- CPU가 정기적으로 폴링(polling)을 해서 입출력 장치 상태를 확인하는 방법도 있찌만 끼어들기를 이용해서 제어하는 것이 효율적이기 때문에 끼어들기를 채택하고 있다.

## 폴링
- 폴링(polling)은 정기적으로 질의하는 것을 가리킨다. 정기적으로 질의함으로써 상대가 어떤 상태인지, 어떤 요구를 가지고 있는지 등을 알 수 있다.

- 질의 방향이 단방향이다.
- 질의는 일정 간격을 따라 정기적으로 발생한다.

- 반복(루프)만 하면 되기에 프로그래밍이 쉽다.
- 상대가 응답하는지 확인할 수 있다.
- 모아서 일괄적으로 처리할 수 있다.

- 웹로직(WebLogic)서버의 내부 감시 기능에 사용한다.
  - 접속 감시는 정기적인 폴링을 이용해서 구현(웹로직 서버)
  - 시간 확인은 정기적으로 실시한다.

### 적합한 처리
- 일정 간격으로 처리르 실행하면 좋은 처리
- 감시

### 부적합한 처리
- 상태가 아닌 입력 내용에 따라 사용 내용을 변경하는 처리
- 처리 우선순위를 정해야하는 처리

### -
- 네트워크 경유한 폴링일 때는 처리 지연 시간을 줄이기 위해 폴링 간격을 너무 짧게 잡으면 트래픽 양이 증가하므로 주의가 필요하다. 또한, 서버의 리소스 소비도 늘어난다.

## 핑퐁
- 핑퐁(pingpong)으 인프라 설꼐나 성능 튜닝에 있어 중요하 개념이다.
- 상자가 너무 작아서 짐을 운반하기 위해 몇 번이고 왕복해야 하는 상황을 핑퐁이라고 부르기로 한다.
  - 물건을 운반할 때는 상자에 넣으면 효율적으로 관리할 수 있다.
  - 운바하는 양에 따라 상자 크기를 선택하면 효율적으로 운반할 수 있다.

- 큰 상자느 대량의 데이터를 빠르게 운반할 수 있으며(처리량 증시), 작은 상자는 소량의 데이터를 빠르게 운반할 수 있다(지연 시간 중시)고 할 수 있다.

## 저널링
- 저널(journal)은 트랜잭션이나 매일 갱신되는 데이터의 변경 이력을 가리킨다.
- 저널을 남겨 두는 것을 저널링(journaling)이라고 한다.
- 저널링은 언제, 어디서, 무엇을 했는지 상세하게 기록해서 시스템 장애가 발생했을 때 어디까지 정상 처리됐는지, 그리고 어디부터 재실행하면 좋을지 알 수 있게 하는 기능이다.

- 데이터 자체가 아닌 처리(트랜잭션) 내용을 기록한다.
- 데이터 일관성이나 일치성이 확보되면 필요 없어진다.
- 데이터 복구 시 롤백(rollback), 롤포워드(rollforward)에 이용된다.

- 데이터를 처리하는 기능은 대부분은 저널링이 구현돼 있으며, 다른 데이터 보호 구조도 존재한다.

- 시스템 장애 시 복구가 빠르다.
- 데이터 복제보다도 적은 리소스를 소비해서 데이터를 보호할 수 있다.

### 적합한 시스템
- 데이터 갱신이 발생하는 시스템

### 부적합한 시스템
- 데이터 안정성보다 성능을 요구하는 시스템

### -
- 롤백은 저널을 읽어서 실제 데이터 저보를 과거로 되돌리는 처리이고, 롤포워드는 저널을 읽어서 실제 데이터 정보를 앞으로 진행시키는 처리다. 이 처리는 트랜잭션 단위로 실행된다.

- 저널 데이터는 메모리의 버퍼에 일단 저장된다. 이 정보가 디스크에 기록되지 않으면 장애 시에 잃을 수 있다. 이 때문에 시스템 요건에 따라 버퍼의 디스크 기록 시점을 검토, 조정 해야한다. 하지만 기록 빈도가 많으면 오버헤드도 높아지기 때문에 절충해서 검토해야한다.
- 저널은 트랜잭션 단위로 일치성을 보증하기 때문에 트랜잭션 도중에 장애가 발생하면 종료되지 않은 트랜잭션은 파괴된다. 하나의 트랜잭션 단위가 크면 트랜잭션 도중에 장애가 발생할 가능성이 높다. 따라서 트랜잭션이 길어지지 않도록 설계해야 한다.

- 저널링은 데이터와 증감 정보를 나우어 기록해서 성능은 물론 장애 발생 시 대처 능력도 확보할 수 있다. 한편 COW(Copy-on-Write)는 기록할 때 복사라는 의미다. 저널링처럼 증감 정보를 작성하지 않고 파일 갱신은 모두 신규 영역에서 한다. 그리고 이것이 모두 완료된 시점에 파일이 참조할 위치를 이전 영역에서 신규영역으로 순식간에 교체하는 방식이다. 순식간에 All or Nothing 변경을 진행한다. DB에서 트랜잭션성과 같은 것이다. 하지만 데이터 영역이 최대 두 배가 필요하다.

## 복제
- 복제(replication)는 DB나 저장소 등에서 자주 사용되는 기술이다.

- 장애 시 데이터 손실을 예방할 수 있다.
- 복제를 이용한 부하 분산이 가능하다.

- 사용자가 데이터에 액세스할 때 복제한 것이라는 것을 의식할 필요가 없다.
- 백업과 달리 실제 데이터가 복제 데이터와 실시간으로 동기화 된다.

### 적합한 시스템
- 데이터 손실을 허용하지 않고 장애 시 복구 속도가 빨라야하는 시스템
- 데이터 참조와 갱신 부분이 나뉘어져 있으며 참조가 많은 시스템

### 부적합한 시스템
- 데이터 갱신이 많은 시스템

### - 
- 복제 위치가 많으면 갱신이 많은 시스템과 같이 복제 오버헤드가 높아진다.
- 실제 데이터와 복제 데이터를 완전히 일치시키고 싶으면 복제 데이터의 쓰기 완료 처리를 보장해야 한다. 이 경우 싀스템 응답이 악화될 수 있다.
- 시스템 유지관리나 장애 시에는 복제 데이터도 고려해야 하기 때문에 설계나 운용 난이도가 높아질 수 있다.
- 복제 데이터와 실제 데이터의 차이가 커지면 그 차이를 채우기 위한 시간이나 성능도 고려해야 한다.

## 마스터-슬레이브(master-slave)
- 주종 관계를 가리킨다.
- 상호 관리라는 의미에서는 피어 두 피어(peer-to-peer) 관계도 성립한다.

- 마스터-슬레이브는 상호 접속 관계의 일종으로, 한 사람이 관리자가 돼서 모든 것을 제어한다.
- 마스터-슬레이브의 반대가 피어 투 피어다.

### 장점
- 관리자가 한 명이기 때문에 구현이 쉽다.
- 슬레이브 간 처리를 동기화할 필요가 없기 때문에 통신량이 줄어든다.

### 단점
- 마스터가 없어지면 관리를 할 수 없다(작업 인계 구조가 필요)
- 마스터의 부하가 높아진다.

## 압축
- 디지털 데이터는 압축 할 수 있다.
- 정보의 낭비를 막으면 압축을 할 수 있다.
- 중복 패턴 인식과 그것을 변경하는 것
- 같은 패턴이 많을수록 압축률이 높아진다.
- 압축을 하는 장점은 데이터 크기를 줄이는 것이고, 단점은 처리 시간이 걸린다는 것이다.
- 가역 압축은 이미 알고 있는 정보를 제거하는 압축 방식
- 비가역 압축은 자신에게 필요 없는 정보를 제거, 즉 최소 필요 정보만 남겨 두는 압축 방식이다.
- 압축한 데이터를 원래돼로 복원할 수 있는 가역 압축과 이미지나 음성 데이터 등에 있는 사람이 인식할 수 없는 부분을 생략하는 비가역 압축이 있다.
- Word나 파워포인트 파일 형식도 zip으로 압축 되어 있어서 해제 할 수 있다.
- 자주 사용되는 것으로 중복 제거(deduplication, 디듀플리케이션)라 불리는 것이 있다.

## 오류 체크 / 오류 수정
- 통신 중에 데이터 파손
- 칩(chip)에서의 데이터 파손

### 오류 검출
- 오류 검출에 반드시 정답이라고 하는 것은 없다.
- 자주 사용되는 방법으로 패리트 비트(parity bit)라는 추가 비트를 부여하는 방법이 있다.
- 추가 데이터를 부여해야 하므로 데이터 양이 증가하며, 오류 여부를 알기 위한 계산이 필요해서 처리에 오버헤드가 발생한다.

### -
- 오류 체크는 디지털 데이터의 오류를 스스로 확인하고, 파손되었을 때 이를 감지하는 것을 의미한다.
- 오류 수정은 자동으로 복구하는 것을 가리킨다.
- 장점은 상위 계층 에서의 오류 관리 없이 데이터 일치성을 일정 수준 보장할 수 있다는 것이다.
- 단점으로는 체크 기능에 의한 리소스 부하 상승, 알고리즘의 복잡화 등을 들 수 있다.



